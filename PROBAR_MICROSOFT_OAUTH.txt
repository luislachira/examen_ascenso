â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  GUÃA RÃPIDA: PROBAR MICROSOFT OAUTH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… CONFIGURACIÃ“N COMPLETADA:
-----------------------------
- Credenciales de Microsoft agregadas al .env
- ParÃ¡metro 'prompt=select_account' configurado
- Mismo comportamiento que Google


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PASO 1: VERIFICAR AZURE AD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

AsegÃºrate de tener configurado en Azure Portal:

1. Redirect URI:
   https://examen-ascenso.com/api/v1/oauth/callback/microsoft

2. Supported account types:
   âœ… Personal Microsoft accounts
   âœ… Work or school accounts
   
3. API Permissions:
   âœ… User.Read
   âœ… openid
   âœ… profile
   âœ… email


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PASO 2: PROBAR REGISTRO CON MICROSOFT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ESCENARIO 1: Primera Cuenta
----------------------------
1. Abre: https://examen-ascenso.com
2. Haz clic en: "Sign in with Microsoft"
3. VerÃ¡s el selector de cuentas de Microsoft:

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Seleccionar una cuenta           â”‚
   â”‚                                    â”‚
   â”‚   â—‹ usuario@outlook.com            â”‚
   â”‚   â—‹ usuario@hotmail.com            â”‚
   â”‚   â—‹ Usar otra cuenta               â”‚
   â”‚                                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. Selecciona una cuenta o "Usar otra cuenta"
5. Autoriza los permisos
6. DeberÃ­as ver:

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚              â³                     â”‚
   â”‚       Registro Exitoso              â”‚
   â”‚                                     â”‚
   â”‚  Tu cuenta ha sido creada           â”‚
   â”‚  correctamente.                     â”‚
   â”‚                                     â”‚
   â”‚  Por favor, espera hasta que el     â”‚
   â”‚  administrador acepte tu solicitud. â”‚
   â”‚                                     â”‚
   â”‚    [Volver al Login]               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ESCENARIO 2: Segunda Cuenta (Selector automÃ¡tico)
--------------------------------------------------
1. Haz clic en: "Volver al Login"
2. Haz clic en: "Sign in with Microsoft"
3. Microsoft muestra SELECTOR DE NUEVO âœ…
4. Selecciona OTRA cuenta de Microsoft
5. Registra la nueva cuenta
6. Ve el mensaje de "Espera aprobaciÃ³n"


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  TIPOS DE CUENTAS MICROSOFT COMPATIBLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Cuentas personales:
   - @hotmail.com
   - @outlook.com
   - @live.com
   - @msn.com

âœ… Cuentas organizacionales:
   - @empresa.com (Azure AD)
   - Cuentas de trabajo o escuela


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  COMPARACIÃ“N: GOOGLE vs MICROSOFT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CaracterÃ­stica         | Google  | Microsoft
-----------------------|---------|----------
Selector de cuentas    | âœ… SÃ­   | âœ… SÃ­
MÃºltiples registros    | âœ… SÃ­   | âœ… SÃ­
Estado PENDIENTE       | âœ… SÃ­   | âœ… SÃ­
Mensaje elegante       | âœ… SÃ­   | âœ… SÃ­
Sin cerrar sesiÃ³n      | âœ… SÃ­   | âœ… SÃ­


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  VERIFICAR USUARIOS REGISTRADOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ejecuta:
--------
php check_usuarios.php

DeberÃ­as ver usuarios de ambos proveedores:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ ID: 5
â”‚ Nombre: Juan PÃ©rez
â”‚ Correo: juan@gmail.com
â”‚ Rol: ğŸ‘¤ Docente
â”‚ Estado: ğŸŸ¡ PENDIENTE
â”‚ Registrado: 2025-10-11 (via Google)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ ID: 6
â”‚ Nombre: MarÃ­a GarcÃ­a
â”‚ Correo: maria@outlook.com
â”‚ Rol: ğŸ‘¤ Docente
â”‚ Estado: ğŸŸ¡ PENDIENTE
â”‚ Registrado: 2025-10-11 (via Microsoft)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PRUEBA COMPLETA: MÃšLTIPLES CUENTAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TEST 1: Google - Cuenta 1
-------------------------
1. Sign in with Google â†’ cuenta1@gmail.com
2. Ver mensaje pendiente âœ…
3. Volver al Login âœ…

TEST 2: Google - Cuenta 2
-------------------------
1. Sign in with Google â†’ selector aparece âœ…
2. Seleccionar cuenta2@gmail.com âœ…
3. Ver mensaje pendiente âœ…
4. Volver al Login âœ…

TEST 3: Microsoft - Cuenta 1
-----------------------------
1. Sign in with Microsoft â†’ usuario@outlook.com
2. Ver mensaje pendiente âœ…
3. Volver al Login âœ…

TEST 4: Microsoft - Cuenta 2
-----------------------------
1. Sign in with Microsoft â†’ selector aparece âœ…
2. Seleccionar otro@hotmail.com âœ…
3. Ver mensaje pendiente âœ…

TEST 5: Aprobar y Login
-----------------------
1. Aprobar cuenta1@gmail.com (estado = '1')
2. Sign in with Google â†’ selector aparece âœ…
3. Seleccionar cuenta1@gmail.com âœ…
4. Acceso directo al dashboard âœ…


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  COMANDOS ÃšTILES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Ver todos los usuarios
php check_usuarios.php

# Aprobar usuario de Microsoft
php artisan tinker --execute="
App\Models\Usuario::where('correo', 'LIKE', '%outlook.com')
  ->update(['estado' => '1']);
echo 'Aprobados';
"

# Eliminar usuarios de prueba
php artisan tinker --execute="
App\Models\Usuario::where('estado', '2')
  ->where('created_at', '>', now()->subHour())
  ->delete();
echo 'Eliminados';
"

# Ver logs en tiempo real
Get-Content storage\logs\laravel.log -Wait -Tail 30


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SOLUCIÃ“N DE PROBLEMAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âŒ Error: "redirect_uri_mismatch"
   â†’ Verifica en Azure Portal:
     https://examen-ascenso.com/api/v1/oauth/callback/microsoft

âŒ Error: "AADSTS50011: The reply URL specified..."
   â†’ La URL de callback no estÃ¡ registrada en Azure
   â†’ Agrega la URL exacta en Azure Portal

âŒ No muestra el selector de cuentas
   â†’ Limpia cachÃ©: php artisan config:clear
   â†’ Verifica que el cÃ³digo tenga 'prompt' => 'select_account'

âŒ Error: "invalid_client"
   â†’ MICROSOFT_CLIENT_ID o SECRET incorrectos
   â†’ Verifica las credenciales en .env

âŒ Error de permisos
   â†’ Agrega permisos en Azure Portal:
     User.Read, openid, profile, email


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ESTADO ACTUAL DEL SISTEMA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Google OAuth: Funcionando
âœ… Microsoft OAuth: Configurado
âœ… Selector de cuentas: Habilitado para ambos
âœ… Estados (Pendiente/Activo/Suspendido): Funcionando
âœ… Mensaje elegante: Implementado
âœ… Logs detallados: Activados
âœ… SSL: Configurado (deshabilitado solo en dev)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Â¡LISTO PARA PROBAR!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ahora puedes:

1. Registrar mÃºltiples usuarios con Google
2. Registrar mÃºltiples usuarios con Microsoft
3. Cambiar entre cuentas sin cerrar sesiÃ³n
4. Ver el selector de cuentas cada vez
5. Aprobar usuarios y hacer login

Â¡Prueba y disfruta! ğŸš€


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
